!function(){"use strict";angular.module("risevision.widget.common.subscription-status.config",[]).value("STORE_URL","http://store.risevision.com/~rvi/store/").value("IN_RVA_PATH","?up_id=iframeId&parent=parentUrl#/product/productId/?inRVA&cid=companyId").value("STORE_SERVER_URL","https://store-dot-rvaserver2.appspot.com/").value("PATH_URL","v1/company/companyId/product/status?pc=")}(),function(){"use strict";angular.module("risevision.widget.common.subscription-status",["risevision.widget.common.subscription-status.config","risevision.widget.common.translate","risevision.widget.common.subscription-status.service","risevision.widget.common"]).directive("subscriptionStatus",["$templateCache","subscriptionStatusService","$location","gadgetsApi","STORE_URL","IN_RVA_PATH",function(t,s,i,e,n,o){return{restrict:"AE",require:"?ngModel",scope:{productId:"@",productCode:"@",companyId:"@"},template:t.get("subscription-status-template.html"),link:function(t,r,a,c){function u(){s.get(t.productCode,t.companyId).then(function(s){s&&(t.subscriptionStatus=s)},function(){})}function p(){if(!f){var s=n+o.replace("parentUrl",encodeURIComponent(i.$$absUrl)).replace("productId",t.productId).replace("companyId",t.companyId);g.find("#store-modal-frame").attr("src",s),d(),f=!0}}function d(){e&&(e.rpc.register("rscmd_saveSettings",l),e.rpc.register("rscmd_closeSettings",m),e.rpc.setupReceiver("store-modal-frame"))}function l(){u(),m()}function m(){t.$apply(function(){t.showStoreModal=!1})}var f=!1,g=$(r);t.showStoreModal=!1,t.subscriptionStatus={status:"N/A",subscribed:!1,expiry:null},t.$watch("companyId",function(s){t.productCode&&t.productId&&s&&u()}),c&&t.$watch("subscribed",function(t){c.$setViewValue(t)});var v=t.$watch("showStoreModal",function(t){t&&(p(),v())})}}}])}(),angular.module("risevision.widget.common.subscription-status").filter("productTrialDaysToExpiry",function(){return function(t){var s="Expiring ";try{var i=Math.floor((new Date(t)-new Date)/864e5)+1;s+=0===i?"Today":"in "+i+" Days"}catch(e){s+="Today"}return s}}),function(){"use strict";angular.module("risevision.widget.common.subscription-status.service",["risevision.widget.common.subscription-status.config"]).service("subscriptionStatusService",["$http","$q","STORE_SERVER_URL","PATH_URL",function(t,s,i,e){var n=["On Trial","Trial Expired","Subscribed","Suspended","Cancelled","Free"];this.get=function(o,r){var a=s.defer(),c=i+e.replace("companyId",r)+o;return t.get(c).then(function(t){if(t&&t.data&&t.data.length){var s=t.data[0];""===s.status?(s.status="N/A",s.subscribed=!1):s.subscribed=s.status===n[0]||s.status===n[2]||s.status===n[5]?!0:!1,a.resolve(s)}else a.reject("No response")}),a.promise}}])}(),function(){try{app=angular.module("risevision.widget.common.subscription-status")}catch(t){app=angular.module("risevision.widget.common.subscription-status",[])}app.run(["$templateCache",function(t){"use strict";t.put("subscription-status-template.html",'<h3>\n  <a href="" ng-click="showStoreModal = true;">\n      <i class="fa fa-info-circle icon-left"></i>\n  </a>\n  <span class="font-weight-normal">{{\'subscription-status.heading\' | translate}} |</span>\n  <a href="" ng-click="showStoreModal = true;">\n    <span ng-class="{\'product-trial\':subscriptionStatus.subscribed, \'product-expired\':!subscriptionStatus.subscribed}">\n        {{subscriptionStatus.status}}\n        <span ng-if="subscriptionStatus.status === \'On Trial\'"> - {{ subscriptionStatus.expiry | productTrialDaysToExpiry }}</span>\n    </span>\n  </a>\n</h3>\n<div class="overlay stack-top" ng-show="showStoreModal"\n  ng-click="showStoreModal = false;">\n</div>\n<iframe id="store-modal-frame" name="store-modal-frame" class="wrapper container modal-content full-screen-modal"\n  ng-show="showStoreModal">\n</iframe>\n')}])}();