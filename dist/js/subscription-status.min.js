!function(){"use strict";angular.module("risevision.widget.common.subscription-status.config",[]).value("STORE_URL","http://store.risevision.com/~rvi/store/").value("PRODUCT_PATH","#/product/productId/").value("STORE_SERVER_URL","https://store-dot-rvaserver2.appspot.com/").value("PATH_URL","v1/company/companyId/product/status?pc=")}(),function(){"use strict";angular.module("risevision.widget.common.subscription-status",["risevision.widget.common.subscription-status.config","risevision.widget.common.service.store","risevision.widget.common"]).directive("subscriptionStatus",["$templateCache","storeService","$location","gadgetsApi",function(t,o,s,i){return{restrict:"AE",require:"?ngModel",scope:{productId:"@",productCode:"@",companyId:"@"},template:t.get("subscription-status-template.html"),link:function(t,e,r,n){function c(){o.getSubscriptionStatus(t.productCode,t.companyId).then(function(o){t.subscribed=!1,o&&(t.subscribed=!0,t.subscriptionStatus=o.status,o.expiry&&(t.subscriptionExpiry=o.expiry))})}function a(){if(!l){var o="http://store.risevision.com/~rvi/store/?up_id=store-modal-frame&parent="+encodeURIComponent(s.$$absUrl)+"#/product/"+t.productId+"/?inRVA&cid="+t.companyId;m.find("#store-modal-frame").attr("src",o),u(),l=!0}}function u(){i&&(i.rpc.register("rscmd_saveSettings",p),i.rpc.register("rscmd_closeSettings",d),i.rpc.setupReceiver("store-modal-frame"))}function p(){c(),d()}function d(){t.$apply(function(){t.showStoreModal=!1})}var l=!1,m=$(e);t.showStoreModal=!1,t.storeModalUrl="",t.$watch("companyId",function(o){t.productCode&&t.productId&&o&&c()}),n&&t.$watch("subscribed",function(t){n.$setViewValue(t)});var f=t.$watch("showStoreModal",function(t){t&&(a(),f())})}}}])}(),angular.module("risevision.widget.common.subscription-status").filter("productTrialDaysToExpiry",function(){return function(t){var o="Expiring ";try{var s=Math.floor((new Date(t)-new Date)/864e5)+1;o+=0===s?"Today":"in "+s+" Days"}catch(i){o+="Today"}return o}}),function(){"use strict";angular.module("risevision.widget.common.service.store",["risevision.widget.common.subscription-status.config"]).service("storeService",["$http","$q","STORE_SERVER_URL","PATH_URL",function(t,o,s,i){this.getSubscriptionStatus=function(e,r){var n=o.defer(),c=s+i.replace("companyId",r)+e;return t.get(c).then(function(t){t&&t.data&&t.data.length?n.resolve(t.data[0]):n.reject("No response")}),n.promise}}])}(),function(){try{app=angular.module("risevision.widget.common.subscription-status")}catch(t){app=angular.module("risevision.widget.common.subscription-status",[])}app.run(["$templateCache",function(t){"use strict";t.put("subscription-status-template.html",'<a href="" ng-click="showStoreModal = true;">\n  <span ng-class="{\'product-trial\':subscribed, \'product-expired\':!subscribed}">\n    <h3>\n      {{subscriptionStatus}}\n      <span ng-if="subscriptionStatus === \'On Trial\'"> - {{ subscriptionExpiry | productTrialDaysToExpiry }}</span>\n      <i class="fa fa-question-circle icon-right"></i>\n    </h3>\n  </span>\n</a>\n<div class="storage-selector-backdrop stack-top" ng-show="showStoreModal"\n  ng-click="showStoreModal = false;">\n</div>\n<iframe id="store-modal-frame" name="store-modal-frame" class="storage-selector-iframe stack-top"\n  ng-show="showStoreModal">\n</iframe>\n')}])}();